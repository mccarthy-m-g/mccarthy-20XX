# Results

```{r}
effect_labels_clean <- c(
    "main_effect",
    "between_sessions",
    "within_sessions",
    "between_states",
    "within_states",
    "between_sessions_states",
    "between_sessions_within_states",
    "within_sessions_between_states",
    "within_sessions_states"
  )

effect_labels <- c(
    "Main effect",
    "Between sessions",
    "Within sessions",
    "Between states",
    "Within states",
    "Between sessions and states",
    "Between sessions and within states",
    "Within sessions and between states",
    "Within sessions and states"
  )

effect_labels <- purrr::set_names(effect_labels, effect_labels_clean)
```

## Overview

The results are separated into five sections, one for each frequency band, covering first the similarities of phase coupling functional connectomes, then amplitude coupling functional connectomes. In each section, we present the results in four plots: (1) a connectivity profile matrix showing the vectorized lower-triangle of the phase or amplitude coupling functional connectome from each recording; (2) a similarity matrix showing the RV coefficient estimates between all pairs of phase or amplitude coupling functional connectomes; (3) an interval plot showing the group-level contrasts estimating the difference in functional connectome similarity within and between participants at various levels of the session and state predictors; and (4) ridge plots showing the results for the individual-level contrasts estimating the difference in functional connectome similarity within and between participants at various levels of the session and state predictors. Descriptions of how these plots can be interpreted can be found in the methods section.

## Delta band

### Phase coupling similarities

Figure \@ref(fig:phase-similarity-plots-delta) shows the connectivity profile matrix, similarity matrix, interval, and ridge plots for phase coupling functional connectome similarities in the delta band. There was a visually obvious group effect, with high similarity between functional connectomes regardless of participant, session, or state (Figure \@ref(fig:phase-similarity-plots-delta)B). This was supported by the group-level contrasts, which showed that although functional connectomes were more similar within participants than between participants at all levels of the session and state predictors, the effect sizes most compatible with our data, given the background model, were at most very small and not practically relevant (Figure \@ref(fig:phase-similarity-plots-delta)C). Moreover, the individual-level contrasts also made it clear that the slightly higher within participant similarity at the group-level should not be overinterpreted, given that the data did not resolve whether the most compatible effect sizes were positive or negative for nearly all participants at most levels of the session and state predictors (Figure \@ref(fig:phase-similarity-plots-delta)D).

```{r phase-similarity-plots-delta}
#| fig.cap: Connectivity profile matrix (A), similarity matrix (B), interval plot (C), and ridge plots (D) for phase coupling functional connectome similarities in the delta band.
targets::tar_load(phase_similarity_results_figure_delta)
knitr::include_graphics(here::here(phase_similarity_results_figure_delta))
```

### Amplitude-coupling similarities

Figure \@ref(fig:amplitude-similarity-plots-delta) shows the connectivity profile matrix, similarity matrix, interval, and ridge plots for amplitude coupling functional connectome similarities in the delta band. There was a visually obvious group effect, with near-perfect similarity between functional connectomes regardless of participant, session, or state (Figure \@ref(fig:amplitude-similarity-plots-delta)A). This was also apparent from the group- and individual-level contrasts, which showed that the differences in functional connectome similarity similarity between and within individuals most compatible with our data, given the background model, were practically nil at all levels of the session and state predictors (Figures \@ref(fig:amplitude-similarity-plots-delta)B, \@ref(fig:amplitude-similarity-plots-delta)C).

```{r amplitude-similarity-plots-delta}
#| fig.cap: Connectivity profile matrix (A), similarity matrix (B), interval plot (C), and ridge plots (D) for amplitude coupling functional connectome similarities in the delta band.
targets::tar_load(amplitude_similarity_results_figure_delta)
knitr::include_graphics(here::here(amplitude_similarity_results_figure_delta))
```

## Theta band

### Phase-coupling similarities

Figure \@ref(fig:phase-similarity-plots-theta) shows the connectivity profile matrix, similarity matrix, interval, and ridge plots for phase coupling functional connectome similarities in the theta band. There was a visually obvious group effect, with high similarity between functional connectomes regardless of participant, session, or state (Figure \@ref(fig:phase-similarity-plots-theta)B)---but with slightly more variability within and between participants than we found with phase coupling functional connectomes in the delta band. This was reflected in the group-level contrasts, which showed that functional connectomes were somewhat more similar within participants than between participants at all levels of the session and state predictors, relative to the delta band; however, the effect sizes most compatible with our data, given the background model, were still at most small and not practically relevant (Figure \@ref(fig:phase-similarity-plots-theta)C). Again the individual-level contrasts made it clear that the higher within participant similarity at the group-level should not be overinterpreted, given that the data did not resolve whether the most compatible effect sizes were positive or negative for roughly half the participants at most levels of the session and state predictors; however, roughly one-third of the participants did have effect sizes that were consistently positive and reasonably compatible with values that were small and practically relevant (\@ref(fig:phase-similarity-plots-theta)D).

```{r phase-similarity-plots-theta}
#| fig.cap: Connectivity profile matrix (A), similarity matrix (B), interval plot (C), and ridge plots (D) for phase coupling functional connectome similarities in the theta band.
targets::tar_load(phase_similarity_results_figure_theta)
knitr::include_graphics(here::here(phase_similarity_results_figure_theta))
```

### Amplitude-coupling similarities

Figure \@ref(fig:amplitude-similarity-plots-theta) shows the connectivity profile matrix, similarity matrix, interval, and ridge plots for amplitude coupling functional connectome similarities in the theta band. Here too there was slightly more variability within and between participants than we found in the delta band, but there was still a visually obvious group effect, with near-perfect similarity between functional connectomes regardless of participant, session, or state (Figure \@ref(fig:amplitude-similarity-plots-theta)B). This was also apparent from the group- and individual-level contrasts, which showed that the differences in functional connectome similarity similarity between and within individuals most compatible with our data, given the background model, were practically nil at all levels of the session and state predictors (Figures \@ref(fig:amplitude-similarity-plots-theta)C, \@ref(fig:amplitude-similarity-plots-theta)D).

```{r amplitude-similarity-plots-theta}
#| fig.cap: Connectivity profile matrix (A), similarity matrix (B), interval plot (C), and ridge plots (D) for amplitude coupling functional connectome similarities in the theta band.
targets::tar_load(amplitude_similarity_results_figure_theta)
knitr::include_graphics(here::here(amplitude_similarity_results_figure_theta))
```

## Alpha band

### Phase-coupling similarities

```{r phase-similarity-emmeans-alpha, eval=FALSE}
# emmeans
targets::tar_load(phase_similarity_emmeans_tidy_alpha)

phase_similarity_emmeans_alpha <- split(
  phase_similarity_emmeans_tidy_alpha,
  phase_similarity_emmeans_tidy_alpha$effect_label
)

## Assign values to objects in global environment for inline printing
xyz <- purrr::map(
  names(phase_similarity_emmeans_alpha),
  ~{
    assign(
      paste0(.x, "_mean"),
      phase_similarity_emmeans_alpha[[.x]][["response"]],
      pos = ".GlobalEnv"
    )
    assign(
      paste0(.x, "_se"),
      phase_similarity_emmeans_alpha[[.x]][["std.error"]],
      pos = ".GlobalEnv"
    )
  }
)

# Contrasts
targets::tar_load(phase_similarity_contrasts_tidy_alpha)

phase_similarity_contrasts_alpha <- phase_similarity_contrasts_tidy_alpha |>
  dplyr::mutate(
    effect_label = forcats::fct_recode(effect_label, !!!effect_labels)
  )

phase_similarity_contrasts_alpha <- split(
  phase_similarity_contrasts_alpha,
  phase_similarity_contrasts_alpha$effect_label
)

## Assign values to objects in global environment for inline printing
zzz <- purrr::map(
  effect_labels_clean,
  ~{
    assign(
      paste0(.x, "_estimate"),
      phase_similarity_contrasts_alpha[[.x]][["estimate"]],
      pos = ".GlobalEnv"
    )
    assign(
      paste0(.x, "_lower"),
      phase_similarity_contrasts_alpha[[.x]][["conf.low"]],
      pos = ".GlobalEnv"
    )
    assign(
      paste0(.x, "_upper"),
      phase_similarity_contrasts_alpha[[.x]][["conf.high"]],
      pos = ".GlobalEnv"
    )
  }
)

# Table
# phase_similarity_emmeans_tidy_alpha |>
#   dplyr::select(effect_label, within_participant, response, std.error) |>
#   dplyr::mutate(
#     effect_label = stringr::str_remove(effect_label, ".+participants_")
#   ) |>
#   tidyr::pivot_wider(
#     names_from = within_participant,
#     values_from = c(response, std.error)
#   ) |> 
#   dplyr::left_join(
#     dplyr::select(
#       phase_similarity_contrasts_alpha,
#       effect_label, estimate, std.error, conf.low, conf.high
#     ),
#   by = "effect_label"
#   ) |> 
#   dplyr::relocate(
#     response_between_participants, std.error_between_participants,
#     .after = std.error_within_participants
#   ) |>
#   dplyr::mutate(dplyr::across(where(is.numeric), papaja::apa_num, digits = 3)) |>
#   gt::gt() |>
#   gt::tab_spanner(
#     "Within Participant",
#     columns = c(response_within_participants,	std.error_within_participants)
#   ) |>
#   gt::tab_spanner(
#     "Between Participant",
#     columns = c(response_between_participants, std.error_between_participants)
#   ) |>
#   gt::tab_spanner(
#     "Contrast",
#     columns = c(estimate, std.error, conf.low, conf.high)
#   ) |>
#   gt::cols_label(
#     effect_label = "Effect",
#     response_within_participants = gt::md("*M*"),
#     std.error_within_participants = gt::md("*SE*"),
#     response_between_participants = gt::md("*M*"),
#     std.error_between_participants = gt::md("*SE*"),
#     estimate = gt::md("*M*"),
#     std.error = gt::md("*SE*"),
#     conf.low = gt::md("95% CI lower"),
#     conf.high = gt::md("95% CI upper")
#   ) |>
#   gt::cols_align(
#     align = "center",
#     columns = -effect_label
#   ) |>
#   gt::tab_options(
#     table.border.top.width = 3,
#     table.border.top.color = "black",
#     table.border.bottom.width = 3,
#     table.border.bottom.color = "black",
#     table_body.hlines.color = "white",
#     column_labels.border.bottom.width = 2,
#     column_labels.border.bottom.color = "black"
#   )
```

Figure \@ref(fig:phase-similarity-plots-alpha) shows the connectivity profile matrix, similarity matrix, interval, and ridge plots for phase coupling functional connectome similarities in the alpha band. There were no visually obvious patterns of similarity consistent across participants, but there were some individual differences worth highlighting: Participant P03 showed high similarity across sessions and states, corresponding to an individual effect; Participants P14, P17, and P19 showed moderate to high similarity in the eyes open state across sessions, and moderate similarity between participants, corresponding to a partial state effect; and participants P07, P08, P11, and P20 showed moderate similarity across sessions and states with themselves and each other, corresponding to a partial group effect. The remaining participants showed no distinctive patterns. Additionally, unlike the delta and theta bands, the amount of similarity between participants was generally moderate and considerably more variable; not consistently high (Figure \@ref(fig:phase-similarity-plots-alpha)B). The group-level contrasts showed that functional connectomes were approximately two to four times more similar within participants than between participants at all levels of the session and state predictors, relative to the theta and delta bands, respectively. However, the effect sizes most compatible with our data, given the background model, were still at most small and not practically relevant at all levels of the effect, with the exception of the within state and the within session and state effects, which showed effect sizes that were at most small but practically relevant (Figure \@ref(fig:phase-similarity-plots-alpha)C). The individual-level contrasts better highlight the inter-individual variability in functional connectome similarities at different levels of the effect, and again highlight that group-level contrasts should not be overinterpreted, given that the data did not resolve whether the most compatible effect sizes were positive or negative for roughly one-third of the participants at most levels of the session and state predictors. However, there was more individual-level consistency with the group-level contrasts for the within state and the within session and state effects, where nearly all participants had effect sizes that were consistently positive and reasonably compatible with values that were small and practically relevant (\@ref(fig:phase-similarity-plots-alpha)D).

```{r phase-similarity-plots-alpha}
#| fig.cap: Connectivity profile matrix (A), similarity matrix (B), interval plot (C), and ridge plots (D) for phase coupling functional connectome similarities in the alpha band.
targets::tar_load(phase_similarity_results_figure_alpha)
knitr::include_graphics(here::here(phase_similarity_results_figure_alpha))
```

### Amplitude-coupling similarities

```{r amplitude-similarity-emmeans-alpha, eval=FALSE}
# emmeans
targets::tar_load(amplitude_similarity_emmeans_tidy_alpha)

amplitude_similarity_emmeans_alpha <- split(
  amplitude_similarity_emmeans_tidy_alpha,
  amplitude_similarity_emmeans_tidy_alpha$effect_label
)

## Assign values to objects in global environment for inline printing
xyz <- purrr::map(
  names(amplitude_similarity_emmeans_alpha),
  ~{
    assign(
      paste0(.x, "_mean"),
      amplitude_similarity_emmeans_alpha[[.x]][["response"]],
      pos = ".GlobalEnv"
    )
    assign(
      paste0(.x, "_se"),
      amplitude_similarity_emmeans_alpha[[.x]][["std.error"]],
      pos = ".GlobalEnv"
    )
  }
)

# Contrasts
targets::tar_load(amplitude_similarity_contrasts_tidy_alpha)

amplitude_similarity_contrasts_alpha <- amplitude_similarity_contrasts_tidy_alpha |>
  dplyr::mutate(
    effect_label = forcats::fct_recode(effect_label, !!!effect_labels)
  )

amplitude_similarity_contrasts_alpha <- split(
  amplitude_similarity_contrasts_alpha,
  amplitude_similarity_contrasts_alpha$effect_label
)

## Assign values to objects in global environment for inline printing
zzz <- purrr::map(
  effect_labels_clean,
  ~{
    assign(
      paste0(.x, "_estimate"),
      amplitude_similarity_contrasts_alpha[[.x]][["estimate"]],
      pos = ".GlobalEnv"
    )
    assign(
      paste0(.x, "_lower"),
      amplitude_similarity_contrasts_alpha[[.x]][["conf.low"]],
      pos = ".GlobalEnv"
    )
    assign(
      paste0(.x, "_upper"),
      amplitude_similarity_contrasts_alpha[[.x]][["conf.high"]],
      pos = ".GlobalEnv"
    )
  }
)
```

Figure \@ref(fig:amplitude-similarity-plots-alpha) shows the connectivity profile matrix, similarity matrix, interval, and ridge plots for amplitude coupling functional connectome similarities in the alpha band. Although there was high similarity between functional connectomes regardless of participant, session, or state---consistent with a group effect---there was noticeably more variability within and between participants than we found in the delta and theta bands, and nearly the same individual differences seen in Figure \@ref(fig:phase-similarity-plots-alpha)B with phase coupling functional connectome similarities were seen here (Figure \@ref(fig:amplitude-similarity-plots-alpha)B). This was reflected in the group-level contrasts, which showed that functional connectomes were more similar within participants than between participants at all levels of the session and state predictors, with effect sizes most compatible with our data, given the background model, that were at most small and not practically relevant (Figure \@ref(fig:amplitude-similarity-plots-alpha)C); and in the individual-level contrasts, which showed similar individual differences as seen with phase coupling functional connectome similarities in Figure \@ref(fig:phase-similarity-plots-alpha)C, but with smaller magnitudes and variation (Figure \@ref(fig:amplitude-similarity-plots-alpha)D). However, the individual-level contrasts also made it clear that that the higher within participant similarity at the group-level should not be overinterpreted, given that the data did not resolve whether the most compatible effect sizes were positive or negative for roughly half the participants at most levels of the session and state predictors, and the roughly one-third of participants whose most compatible effect sizes were consistently positive were still at most small and not practically relevant.

<!-- This is perhaps unsurprising, given that phase values estimated with the cross spectral density are weighted by amplitude [@cohen_AnalyzingNeuralTime_2014] -->

```{r amplitude-similarity-plots-alpha}
#| fig.cap: Connectivity profile matrix (A), similarity matrix (B), interval plot (C), and ridge plots (D) for amplitude coupling functional connectome similarities in the alpha band.
targets::tar_load(amplitude_similarity_results_figure_alpha)
knitr::include_graphics(here::here(amplitude_similarity_results_figure_alpha))
```

## Beta band

### Phase-coupling similarities

Figure \@ref(fig:phase-similarity-plots-beta) shows the connectivity profile matrix, similarity matrix, interval, and ridge plots for phase coupling functional connectome similarities in the beta band. There was a visually obvious group effect, with high similarity between functional connectomes regardless of participant, session, or state (Figure \@ref(fig:phase-similarity-plots-beta)B)---but with slightly more variability within and between participants than we found with phase coupling functional connectomes in the delta and theta bands. This was reflected in the group-level contrasts, which showed that functional connectomes were somewhat more similar within participants than between participants at all levels of the session and state predictors, relative to the delta and theta bands; however, the effect sizes most compatible with our data, given the background model, were still at most small and not practically relevant (Figure \@ref(fig:phase-similarity-plots-beta)C). Again the individual-level contrasts made it clear that the higher within participant similarity at the group-level should not be overinterpreted, given that the data did not resolve whether the most compatible effect sizes were positive or negative for roughly one-third of the participants at most levels of the session and state predictors; however, roughly two-thirds of the participants did have effect sizes that were consistently positive and reasonably compatible with values that were small and practically relevant (\@ref(fig:phase-similarity-plots-beta)D).

```{r phase-similarity-plots-beta}
#| fig.cap: Connectivity profile matrix (A), similarity matrix (B), interval plot (C), and ridge plots (D) for phase coupling functional connectome similarities in the beta band.
targets::tar_load(phase_similarity_results_figure_beta)
knitr::include_graphics(here::here(phase_similarity_results_figure_beta))
```

### Amplitude-coupling similarities

Figure \@ref(fig:amplitude-similarity-plots-beta) shows the connectivity profile matrix, similarity matrix, interval, and ridge plots for amplitude coupling functional connectome similarities in the beta band. There was a visually obvious group effect, with near-perfect similarity between functional connectomes regardless of participant, session, or state, like we saw in the delta and theta bands (Figure \@ref(fig:amplitude-similarity-plots-beta)B). This was also apparent from the group- and individual-level contrasts, which showed that the differences in functional connectome similarity similarity between and within individuals most compatible with our data, given the background model, were practically nil at all levels of the session and state predictors (Figures \@ref(fig:amplitude-similarity-plots-beta)C, \@ref(fig:amplitude-similarity-plots-beta)D).

```{r amplitude-similarity-plots-beta}
#| fig.cap: Connectivity profile matrix (A), similarity matrix (B), interval plot (C), and ridge plots (D) for amplitude coupling functional connectome similarities in the beta band.
targets::tar_load(amplitude_similarity_results_figure_beta)
knitr::include_graphics(here::here(amplitude_similarity_results_figure_beta))
```

## Gamma band

### Phase-coupling similarities

Figure \@ref(fig:phase-similarity-plots-gamma) shows the connectivity profile matrix, similarity matrix, interval, and ridge plots for phase coupling functional connectome similarities in the gamma band. There was a visually obvious group effect, with high similarity between functional connectomes regardless of participant, session, or state for all participants but P21 (Figure \@ref(fig:phase-similarity-plots-gamma)B), with a similar degree of variability within and between participants as we found with phase coupling functional connectomes in the delta and theta band. This was supported by the group-level contrasts, which showed that although functional connectomes were more similar within participants than between participants at all levels of the session and state predictors, the effect sizes most compatible with our data, given the background model, were at most very small and not practically relevant (Figure \@ref(fig:phase-similarity-plots-gamma)C). Moreover, the individual-level contrasts also made it clear that the slightly higher within participant similarity at the group-level should not be overinterpreted, given that the data did not resolve whether the most compatible effect sizes were positive or negative for nearly all participants at most levels of the session and state predictors (Figure \@ref(fig:phase-similarity-plots-gamma)D).

```{r phase-similarity-plots-gamma}
#| fig.cap: Connectivity profile matrix (A), similarity matrix (B), interval plot (C), and ridge plots (D) for phase coupling functional connectome similarities in the gamma band.
targets::tar_load(phase_similarity_results_figure_gamma)
knitr::include_graphics(here::here(phase_similarity_results_figure_gamma))
```

### Amplitude-coupling similarities

Figure \@ref(fig:amplitude-similarity-plots-gamma) shows the connectivity profile matrix, similarity matrix, interval, and ridge plots for amplitude coupling functional connectome similarities in the gamma band. There was a visually obvious group effect, with near-perfect similarity between functional connectomes regardless of participant, session, or state, like we saw in the delta, theta, and beta bands (Figure \@ref(fig:amplitude-similarity-plots-beta)B). This was also apparent from the group- and individual-level contrasts, which showed that the differences in functional connectome similarity similarity between and within individuals most compatible with our data, given the background model, were practically nil at all levels of the session and state predictors (Figures \@ref(fig:amplitude-similarity-plots-gamma)C, \@ref(fig:amplitude-similarity-plots-gamma)D).

```{r amplitude-similarity-plots-gamma}
#| fig.cap: Connectivity profile matrix (A), similarity matrix (B), interval plot (C), and ridge plots (D) for amplitude coupling functional connectome similarities in the gamma band.
targets::tar_load(amplitude_similarity_results_figure_gamma)
knitr::include_graphics(here::here(amplitude_similarity_results_figure_gamma))
```
